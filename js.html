<script>

     function insertarContacto()
    {
      //obtener datos
      let nombre = document.getElementById('nombre').value;
      let apellidos = document.getElementById('apellidos').value;
      let correo = document.getElementById('correo').value;
      let telf = document.getElementById('telf').value;

      //cerrar modal
       bootstrap.Modal.getInstance(document.getElementById('crearContactoModal')).hide();

      //eliminar tabla
      eliminarTabla();
    
      //crear loader
    crearLoaderPuntos('divContactos');

     google.script.run
     .withSuccessHandler(contactosInsertadoCorrectamente)
     .withFailureHandler(contactoInsertadoError)
     .insertarContactos(nombre, apellidos, correo, telf);
    }

    function contactosInsertadoCorrectamente()
    {
      //eliminamos los datos de los inputs
       document.getElementById('nombre').value = '';
      document.getElementById('correo').value = '';

      //mostrar notificaciones
      crearNotificacionOK('Contacto insertado correctamente','CONTACTO OK');

      //eliminar loader
      eliminarLoader();

      //mostramos la tabla
      crearTablaContactos();
    }

    function contactoInsertadoError()
    {
     crearNotificacionError('No se ha podido insertar el contacto','ERROR');

     //eliminar loader
      eliminarLoader();

       //mostramos la tabla
      crearTablaContactos();
    }

    function crearTablaContactos()
    {
      //eliminamos la tabla si existe
      eliminarTabla();

      //crear loader
    crearLoaderPuntos('divContactos');

     google.script.run
     .withSuccessHandler(crearTablaContactosCorrectamente)
     .withFailureHandler(crearTablaContactosError)
     .obtenerContactos();
    }

    function crearTablaContactosCorrectamente(obj)
        {
            tabla = document.createElement('table');
            tabla.id = 'tablaContactos';

            let tablaHeader = document.createElement('thead');
            let tablaBody = document.createElement('tbody');

            //header de la p치gina
            let primeraFila = document.createElement('tr');
            for(let i = 0; i<obj[0].length; i++)
            {
              let celda = document.createElement('td');
              celda.textContent = obj[0][i];
              primeraFila.appendChild(celda);
            }
            tablaHeader.appendChild(primeraFila);
            tabla.appendChild(tablaHeader);

            //body de la tabla
            for(let i = 1; i <obj.lengt; i++)
            {
              let fila = document.createElement('tr');
              for(let j = 0; j< obj[i].lengt; j++)
              {
                let celda = document.createElement('td');
              celda.textContent = obj[i][j];
              fila.appendChild(celda);
              }
             
           tablaBody.appendChild(fila);
         }
        //agregamos clases a la cabecera
        tablaHeader.classList.add('table-dark');
        //agregamos el cuerpo a la tabla
        tabla.appendChild(tablaBody);
        //agregamos clase a la tabla
        tabla.classList.add('table','table-striped','border', 'border-4','border-dark');
        //agregamos tabla a la p치gina
        document.getElementById('divContactos').appendChild(tabla);

        //mostrar notificaci칩n de ok
        crearNotificacionOK('Contactos obtenidos correctamente', 'Todo en orden');

        //eliminamos el loader
        eliminarLoader();
        }

        function crearTablaContactosError()
        {
          //mostrar notificaci칩n de error
          crearNotificacionError('No se han podido leer los contactos', 'ERROR');

          //eliminamos el loader
        eliminarLoader();
        }

        function crearNotificacion(mensaje, titulo)
        {
          document.getElementById('mensajeNotificacion').textContent = mensaje;
          document.getElementById('tituloNotificacion').textContent = titulo;
          let elementNotificacion = document.getElementById('notificacion');
          bootstrap.Toast.getOrCreateInstance(elementoNotificacion).show();
        }

        function crearNotificacionOK(mensaje, titulo)
        {
          crearNotificacion(mensaje, titulo);
          crearIconoNotificacionOK();
          crearColorNotificacion(--'color-verde-oscuro');
        }

        function crearNotificacionError(mensaje, titulo)
        {
          crearNotificacion(mensaje, titulo);
          crearIconoNotificacionError();
          crearColorNotificacion(--'color-rojo-oscuro');
        }

        function crearNotificacionAdvertencia(mensaje, titulo)
        {
          crearNotificacion(mensaje, titulo);
          crearIconoNotificacionAdvertencia();
          crearColorNotificacion(--'color-amarillo-oscuro');
        }

         function crearIconoNotificacionOK()
         {
          document.getElementById('iconoNotificacion').className = '';
          document.getElementById('iconoNotificacion').classList.add('bi','bi-check2-square');
         }

         function crearIconoNotificacionError()
         {
          document.getElementById('iconoNotificacion').className = '';
          document.getElementById('iconoNotificacion').classList.add('bi','bi-bug');
         }

         function crearIconoNotificacionAdvertencia()
         {
          document.getElementById('iconoNotificacion').className = '';
          document.getElementById('iconoNotificacion').classList.add('bi','bi-exclamation-square');         
         }
         
         function crearColorNotificacion(color)
         {
          let elementNotificacion = document.getElementById('notificacion');
          elementoNotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue(color);
         }



       function crearLoader(elementoPadre)
       {
        eliminarLoader();
         let loader = document.createElement('div');
         loader.id = 'loader';
         loader.appendChild(document.createElement('div'));
         loader.appendChild(document.createElement('div'));
         loader.appendChild(document.createElement('div'));
         loader.appendChild(document.createElement('div'));
         return document.getElementById(elementoPadre).appendChild(loader);
       }
       
       function crearLoaderPuntos(elementoPadre)
       {
         let loader = crearLoader(elementoPadre);
         loader.classList.add('lds-ellipsis');
       }
       function crearLoaderAnillo(elementoPadre)
       {
         let loader = crearLoader(elementoPadre);
         loader.classList.add('lds-ring');
       }

       function eliminarLoader()
       {
        let loader = document.getElementById('loader');
        if(loader) loader.remove();
       }

       function eliminarTabla()
       {
        let tabla = document.getElementById('tablaContactos');
        if(tabla) tabla.remove();
       }

</script>